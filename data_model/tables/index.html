<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.91.2">
<meta name=description content>
<link rel=icon href=/zcash-sync/images/favicon.png type=image/png>
<title>Tables :: Zcash Warp Sync</title>
<link href=/zcash-sync/css/nucleus.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/fontawesome-all.min.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/hybrid.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/featherlight.min.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/perfect-scrollbar.min.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/auto-complete.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/atom-one-dark-reasonable.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/theme.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/tabs.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/hugo-theme.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/css/theme-blue.css?1664445049 rel=stylesheet>
<link href=/zcash-sync/common.css?1664445049 rel=stylesheet>
<script src=/zcash-sync/js/jquery-3.3.1.min.js?1664445049></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity=sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs crossorigin=anonymous>
</head>
<body data-url=/zcash-sync/data_model/tables/>
<nav id=sidebar class=showVisitedLinks>
<div id=header-wrapper>
<div id=header>
<a id=logo href=https://hhanh00.github.io/zcash-sync/>
<img srcset="https://hhanh00.github.io/zcash-sync//logo.png 4x">
</a>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=/zcash-sync/js/lunr.min.js?1664445049></script>
<script type=text/javascript src=/zcash-sync/js/auto-complete.js?1664445049></script>
<script type=text/javascript>var baseurl="https://hhanh00.github.io/zcash-sync/"</script>
<script type=text/javascript src=/zcash-sync/js/search.js?1664445049></script>
</div>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/zcash-sync/light_wallet/ title="Light Wallets" class=dd-item>
<a href=/zcash-sync/light_wallet/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#wallet"/></svg>
Light Wallets
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/zcash-sync/light_wallet/purpose/ title=Purpose class=dd-item>
<a href=/zcash-sync/light_wallet/purpose/>
Purpose
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/light_wallet/privacy/ title=Privacy class=dd-item>
<a href=/zcash-sync/light_wallet/privacy/>
Privacy
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/light_wallet/utxo/ title="UTXO Model" class=dd-item>
<a href=/zcash-sync/light_wallet/utxo/>
UTXO Model
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/light_wallet/scan/ title="Scan / Sync" class=dd-item>
<a href=/zcash-sync/light_wallet/scan/>
Scan / Sync
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/light_wallet/reorg/ title=Reorganization class=dd-item>
<a href=/zcash-sync/light_wallet/reorg/>
Reorganization
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/zcash-sync/data_model/ title="Data Model" class="dd-item
parent">
<a href=/zcash-sync/data_model/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#db"/></svg>
Data Model
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/zcash-sync/data_model/tables/ title=Tables class="dd-item active">
<a href=/zcash-sync/data_model/tables/>
Tables
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/data_model/chunks/ title="Block Chunks" class=dd-item>
<a href=/zcash-sync/data_model/chunks/>
Block Chunks
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/data_model/rollback/ title=Rollback class=dd-item>
<a href=/zcash-sync/data_model/rollback/>
Rollback
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/zcash-sync/execution_model/ title="Execution Model" class=dd-item>
<a href=/zcash-sync/execution_model/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#work"/></svg>
Execution Model
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/zcash-sync/execution_model/tasks/ title=Tasks class=dd-item>
<a href=/zcash-sync/execution_model/tasks/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#task"/></svg>
Tasks
<i class="fas fa-check read-icon"></i>
</a>
<ul>
<li data-nav-id=/zcash-sync/execution_model/tasks/download/ title=Download class=dd-item>
<a href=/zcash-sync/execution_model/tasks/download/>
Download
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/execution_model/tasks/decrypt/ title=Decrypt class=dd-item>
<a href=/zcash-sync/execution_model/tasks/decrypt/>
Decrypt
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/execution_model/tasks/witnesses/ title=Witnesses class=dd-item>
<a href=/zcash-sync/execution_model/tasks/witnesses/>
Witnesses
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/zcash-sync/execution_model/pipeline/ title=Pipeline class=dd-item>
<a href=/zcash-sync/execution_model/pipeline/>
Pipeline
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/execution_model/agents/ title=Agents class=dd-item>
<a href=/zcash-sync/execution_model/agents/>
Agents
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
</li>
<li data-nav-id=/zcash-sync/api/ title=Interface class=dd-item>
<a href=/zcash-sync/api/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#api"/></svg>
Interface
<i class="fas fa-check read-icon"></i>
</a>
</li>
<li data-nav-id=/zcash-sync/example/ title=Example class=dd-item>
<a href=/zcash-sync/example/><svg class="icon"><use xlink:href="https://hhanh00.github.io/zcash-sync//sprite.svg#demo"/></svg>
Example
<i class="fas fa-check read-icon"></i>
</a>
</li>
</ul>
<section id=prefooter>
<hr>
<ul>
<li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li>
</ul>
</section>
<section id=footer>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=/zcash-sync/>WarpSync</a> > <a href=/zcash-sync/data_model/>Data Model</a> > Tables
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#blocks>Blocks</a></li>
<li><a href=#transactions>Transactions</a></li>
<li><a href=#received-notes>Received Notes</a></li>
<li><a href=#witnesses>Witnesses</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Tables
</h1>
<p>In the previous section, we discusses the overall goals of scanning the
blockchain. Now we are going to look at the data obtained after the scan
completes.</p>
<p>From the &ldquo;largest&rdquo; data to the &ldquo;smallest&rdquo; data:</p>
<h2 id=blocks>Blocks</h2>
<p>First we have blocks. We keep the block:</p>
<ul>
<li>height, hash and time,</li>
<li>sapling tree</li>
</ul>
<p>The sapling tree field is unique to Zcash. The wallet needs it
to update the note witnesses.</p>
<h2 id=transactions>Transactions</h2>
<p>The wallet only keeps the transactions for which it has detected either
an incoming note or a spent note. Transparent transactions are not
kept. They are not included in the wallet history either.</p>
<ul>
<li>id_tx: the id of the transactions. This is an internal ID only used by
in our database.</li>
<li>the account id</li>
<li>the txid: the hash of the transaction. That&rsquo;s public information</li>
<li>the height of the block that contains this transaction. Since there can only
be one block at a given height, it uniquely identifies the block too</li>
<li>the <em>net</em> value of the transaction in Zats</li>
<li>the address of the spend/destination. For transactions that involve multiple recipients
that we know about, the address is arbitrary one of them. For example, if you make
a transaction from your account to several of your own accounts, there will be
one transaction row per account, but the destination address will just be one of the
recipients</li>
<li>the memo of one of the notes. If you make a multi-payment transaction, only one of
the memos will be stored</li>
<li>the tx_index: the position of the transaction in the block</li>
</ul>
<div class="notices note"><p>Multi-payment transactions are rare. That&rsquo;s why the database model does not match
directly with the UTXO model. Technically speaking, every UTXO has its own
address and memo.</p>
</div>
<p>The Transaction table is only used for the Transaction History view. It is
not used for calculating the balance or for building new transactions.
In other words, it&rsquo;s purely informational.</p>
<h2 id=received-notes>Received Notes</h2>
<p>On the contrary, the Received Notes table plays a critical role in
defining the account state.</p>
<p>The Received Notes table has the following columns:</p>
<ul>
<li>id_note: The primary key of the table</li>
<li>account: the account ID to which this note belongs</li>
<li>position: the absolute position of the note in the overall commitment tree.
The first shielded output has position 0 and every output (regardless of
its owner) increments the position. The order is determined by the order in
which the output appeared in the blockchain. Unconfirmed transactions do not
have a position</li>
<li>tx: the id of the transaction (not the tx hash)</li>
<li>height: the height of the block (same as tx height),</li>
<li>output_index: A transaction can have multiple outputs. This is the index of
the received note inside the transaction</li>
<li>diversifier: Once decoded, we know the diversifier value that was used to
derive the address. In zcash, a secret key can generate millions of addresses
though many wallets just use one of them</li>
<li>value: the amount of the note in Zats</li>
<li>rcm: the random value used by sender when generating the output note.</li>
<li>nf: the note nullifier. We calculate this value from the note position and
the full viewing key. The note nullifier is <em>not</em> known by the sender</li>
<li>spent: the block height when the note is spent. If the note is unspent, spent
is NULL. If the note is spent but unconfirmed, height is equal to 0</li>
<li>excluded: a boolean flag that indicates if this note should be excluded from
note selection when make a new payment</li>
</ul>
<p>The Received Notes table allows us to:</p>
<ul>
<li>compute the account balances by summing the value of unspent notes,</li>
<li>find which notes can be spent in new transactions</li>
<li>rollback the blockchain when there is a <a href=/zcash-sync/light_wallet/reorg/>reorganization</a></li>
</ul>
<h2 id=witnesses>Witnesses</h2>
<p>Finally, we have the note witnesses table.</p>
<ul>
<li>id_witness: The primary key of the table</li>
<li>note: The id of the note</li>
<li>height: The height of the witness</li>
<li>witness: The value of the witness</li>
</ul>
<p>There is a unique witness for a given a note and a height.</p>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=/zcash-sync/data_model/ title="Data Model"> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/zcash-sync/data_model/chunks/ title="Block Chunks" style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/zcash-sync/js/clipboard.min.js?1664445049></script>
<script src=/zcash-sync/js/perfect-scrollbar.min.js?1664445049></script>
<script src=/zcash-sync/js/perfect-scrollbar.jquery.min.js?1664445049></script>
<script src=/zcash-sync/js/jquery.sticky.js?1664445049></script>
<script src=/zcash-sync/js/featherlight.min.js?1664445049></script>
<script src=/zcash-sync/js/highlight.pack.js?1664445049></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/zcash-sync/js/modernizr.custom-3.6.0.js?1664445049></script>
<script src=/zcash-sync/js/learn.js?1664445049></script>
<script src=/zcash-sync/js/hugo-learn.js?1664445049></script>
<script src=/zcash-sync/mermaid/mermaid.js?1664445049></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity=sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script>
</body>
</html>